{% extends "blog/base.html"%}
{% load static %}

{%block title%} {{post.title}} {% endblock %}

{%block css_file%} 
 <link rel="stylesheet", href="{% static "blog/post-detail.css"%}">
{%endblock%}


{% block content %}
  <section id="summary">

      {% if user.is_authenticated %}
        <a href="{%url 'add-tag-post' post.slug%}" class="btn btn-info">Create discussion tag</a>
      {% endif %}
        <h2>{{post.title}}</h2>
        <div style='width: 70%; text-align:left;'>
            {%for tag in tags %}
              <span class="tagged"> {{tag.caption}}</span>
            {% endfor%}
        </div>
        
        <article>
            <img src="{{post.image.url}}" alt="{{post.title}}">
            <address>By {{post.author}}</address>
            <div>Last updated on <time> {{post.date |date:"d M Y" }}</time></div>
        </article>
  </section>
    {% if user.is_authenticated %}
            <main>
          
                {%if edit_rights %}
                  <a href="{%url 'delete-post' post.slug%}" class="btn btn-danger"> Delete Post</a>
                  <!-- <a href="{{post.slug}}/edit" class="btn btn-info">Edit Post</a> -->
                  <a href="{%url 'edit-post-page' post.slug%}" class="btn btn-info">Edit Post</a>

                {% else %}
                  <button class="btn btn-danger" disabled=True>Delete Post</button>
                  <a disabled=True class="btn btn-info">Edit Post</a>
                {% endif %}
          
            </main>

            <main>
                  {{post.content}}
                  <br>
                    <form action="{% url 'like-post' post.slug %}" method="POST">
                        {% csrf_token%}
                    
                        {% if request.user in post.likes.all%}
                            <button type="submit", name="post_id", value="{{post.id}}",
                            class="btn btn-danger btn-sm">Unlike</button>
                        {% else %}
                            <button type="submit", name="post_id", value="{{post.id}}",
                            class="btn btn-primary btn-sm">Like</button>
                        {% endif%}
                            
                        
                        - {{post.total_likes}} likes 
                        <hr>
                  </form>
            
                  <h2> Comments..</h2>
                  {% if user.is_authenticated %}
                      {% if not comments.all %}
                          No Comments Yet.... 
                      {% else %}
                            {% for comment in comments.all %}
                                <strong>
                                    {{comment.commentor.username}} -
                                    {{comment.date_added}}
                                </strong>
                                {{comment.body}}
                            
                                  <form action="{% url 'like-comment' post.slug %}" method="POST">
                                      {% csrf_token%}
                              
                                      {% if liked%}
                                          <button type="submit", name="comment_id", value="{{comment.id}}",
                                          class="btn btn-danger btn-sm">Unlike</button>
                                      {% else %}
                                          <button type="submit", name="comment_id", value="{{comment.id}}",
                                          class="btn btn-primary btn-sm">Like</button>
                                      {% endif%}
                                          
                                      
                                      - {{comment.total_likes}} likes
                                      
                                      {%if request.user.username == comment.commentor.username %}
                                          <a href="{% url 'delete-comment' post.pk %}" class="btn btn-danger">Delete</a>
                                      {% endif %}

                                  </form>
                                <br>
                            {% endfor %}   
                            <hr>
                      {% endif %}

                  {% endif %}
                      
                  

          
              

                  <h2> Add a new comment</h2>
                  {% if user.is_authenticated %}
                    <div class="row mr-10"> 
                      <div class="col-md-6">
                        <form method="POST" enctype="multipart/form-data"> 
                          {% csrf_token %}
                          {{formC.as_p}}
                          <button type="submit" class="btn btn-light">Post</button>
                      </form>    
                      </div>
                      <div class="col-md-6">
                        
                    </div>
                  {% else %}
                      
                        <div class="col-md-6">
                          
                      </div>
                  {% endif %}
            </main>
      {%else%}
      
        <main>
          <div class="alert alert-danger" role="alert">
            To leave a comment on the discussion, please first <strong>register or login</strong> with an existing account!
          </div>
          <p></p>
        </main>
            
      {% endif %} 
{% endblock %}